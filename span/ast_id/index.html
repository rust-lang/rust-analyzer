<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="`AstIdMap` allows to create stable IDs for â€œlargeâ€ syntax nodes like items and macro calls."><title>span::ast_id - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2"href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../static.files/rustdoc-ca0dd0c4.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="span" data-themes="" data-resource-suffix="" data-rustdoc-version="1.93.1 (01f6ddf75 2026-02-11)" data-channel="1.93.1" data-search-js="search-9e2438ea.js" data-stringdex-js="stringdex-a3946164.js" data-settings-js="settings-c38705f0.js" ><script src="../../static.files/storage-e2aeef58.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../static.files/main-a410ff4d.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-263c88ec.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-eab170b8.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><rustdoc-topbar><h2><a href="#">Module ast_id</a></h2></rustdoc-topbar><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../span/index.html">span</a><span class="version">0.0.0</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module ast_id</a></h2><h3><a href="#macros">Module Items</a></h3><ul class="block"><li><a href="#macros" title="Macros">Macros</a></li><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#enums" title="Enums">Enums</a></li><li><a href="#constants" title="Constants">Constants</a></li><li><a href="#traits" title="Traits">Traits</a></li><li><a href="#functions" title="Functions">Functions</a></li><li><a href="#types" title="Type Aliases">Type Aliases</a></li></ul></section><div id="rustdoc-modnav"><h2 class="in-crate"><a href="../index.html">In crate span</a></h2></div></div></nav><div class="sidebar-resizer" title="Drag to resize sidebar"></div><main><div class="width-limiter"><section id="main-content" class="content"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="../index.html">span</a></div><h1>Module <span>ast_id</span>&nbsp;<button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../src/span/ast_id.rs.html#1-962">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p><code>AstIdMap</code> allows to create stable IDs for â€œlargeâ€ syntax nodes like items
and macro calls.</p>
<p>Specifically, it enumerates all items in a file and uses position of a an
item as an ID. That way, idâ€™s donâ€™t change unless the set of items itself
changes.</p>
<p>These IDs are tricky. If one of them invalidates, its interned ID invalidates,
and this can cause <em>a lot</em> to be recomputed. For example, if you invalidate the ID
of a struct, and that struct has an impl (any impl!) this will cause the <code>Self</code>
type of the impl to invalidate, which will cause the all impls queries to be
invalidated, which will cause every trait solve query in this crate <em>and</em> all
transitive reverse dependencies to be invalidated, which is pretty much the worst
thing that can happen incrementality wise.</p>
<p>So we want these IDs to stay as stable as possible. For top-level items, we store
their kind and name, which should be unique, but since they can still not be, we
also store an index disambiguator. For nested items, we also store the ID of their
parent. For macro calls, we store the macro name and an index. There arenâ€™t usually
a lot of macro calls in item position, and invalidation in bodies is not much of
a problem, so this should be enough.</p>
</div></details><h2 id="macros" class="section-header">Macros<a href="#macros" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="macro" href="macro.register_assoc_item_ast_id.html" title="macro span::ast_id::register_assoc_item_ast_id">register_<wbr>assoc_<wbr>item_<wbr>ast_<wbr>id</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dt><a class="macro" href="macro.register_enum_ast_id.html" title="macro span::ast_id::register_enum_ast_id">register_<wbr>enum_<wbr>ast_<wbr>id</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dt><a class="macro" href="macro.register_has_name_ast_id.html" title="macro span::ast_id::register_has_name_ast_id">register_<wbr>has_<wbr>name_<wbr>ast_<wbr>id</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt></dl><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="struct" href="struct.AstIdMap.html" title="struct span::ast_id::AstIdMap">AstId<wbr>Map</a></dt><dd>Maps itemsâ€™ <code>SyntaxNode</code>s to <code>ErasedFileAstId</code>s and back.</dd><dt><a class="struct" href="struct.BlockExprFileAstId.html" title="struct span::ast_id::BlockExprFileAstId">Block<wbr>Expr<wbr>File<wbr>AstId</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dt><a class="struct" href="struct.ErasedAssocItemFileAstId.html" title="struct span::ast_id::ErasedAssocItemFileAstId">Erased<wbr>Assoc<wbr>Item<wbr>File<wbr>AstId</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dd>This holds the ast ID for variants too (theyâ€™re a kind of assoc item).</dd><dt><a class="struct" href="struct.ErasedAstIdNextIndexMap.html" title="struct span::ast_id::ErasedAstIdNextIndexMap">Erased<wbr>AstId<wbr>Next<wbr>Index<wbr>Map</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dt><a class="struct" href="struct.ErasedFileAstId.html" title="struct span::ast_id::ErasedFileAstId">Erased<wbr>File<wbr>AstId</a></dt><dd>This is a type erased FileAstId.</dd><dt><a class="struct" href="struct.ErasedHasNameFileAstId.html" title="struct span::ast_id::ErasedHasNameFileAstId">Erased<wbr>HasName<wbr>File<wbr>AstId</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dt><a class="struct" href="struct.FileAstId.html" title="struct span::ast_id::FileAstId">File<wbr>AstId</a></dt><dd><code>AstId</code> points to an AST node in a specific file.</dd><dt><a class="struct" href="struct.ImplFileAstId.html" title="struct span::ast_id::ImplFileAstId">Impl<wbr>File<wbr>AstId</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt></dl><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="enum" href="enum.ContainsItems.html" title="enum span::ast_id::ContainsItems">Contains<wbr>Items</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dt><a class="enum" href="enum.ErasedFileAstIdKind.html" title="enum span::ast_id::ErasedFileAstIdKind">Erased<wbr>File<wbr>AstId<wbr>Kind</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt></dl><h2 id="constants" class="section-header">Constants<a href="#constants" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="constant" href="constant.FIXUP_ERASED_FILE_AST_ID_MARKER.html" title="constant span::ast_id::FIXUP_ERASED_FILE_AST_ID_MARKER">FIXUP_<wbr>ERASED_<wbr>FILE_<wbr>AST_<wbr>ID_<wbr>MARKER</a></dt><dd>ErasedFileAstId used as the span for syntax node fixups. Any Span containing this file id is to be
considered fake.
Do not modify this, it is used by the proc-macro server.</dd><dt><a class="constant" href="constant.HASH_BITS.html" title="constant span::ast_id::HASH_BITS">HASH_<wbr>BITS</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dt><a class="constant" href="constant.INDEX_BITS.html" title="constant span::ast_id::INDEX_BITS">INDEX_<wbr>BITS</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dt><a class="constant" href="constant.KIND_BITS.html" title="constant span::ast_id::KIND_BITS">KIND_<wbr>BITS</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dt><a class="constant" href="constant.NO_DOWNMAP_ERASED_FILE_AST_ID_MARKER.html" title="constant span::ast_id::NO_DOWNMAP_ERASED_FILE_AST_ID_MARKER">NO_<wbr>DOWNMAP_<wbr>ERASED_<wbr>FILE_<wbr>AST_<wbr>ID_<wbr>MARKER</a></dt><dd><a href="../struct.ErasedFileAstId.html" title="struct span::ErasedFileAstId"><code>ErasedFileAstId</code></a> used as the span for syntax nodes that should not be mapped down to
macro expansion. Any <code>Span</code> containing this file id is to be considered fake.</dd><dt><a class="constant" href="constant.ROOT_ERASED_FILE_AST_ID.html" title="constant span::ast_id::ROOT_ERASED_FILE_AST_ID">ROOT_<wbr>ERASED_<wbr>FILE_<wbr>AST_<wbr>ID</a></dt><dd>The root ast id always points to the encompassing file, using this in spans is discouraged as
any range relative to it will be effectively absolute, ruining the entire point of anchored
relative text ranges.</dd></dl><h2 id="traits" class="section-header">Traits<a href="#traits" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="trait" href="trait.AstIdNode.html" title="trait span::ast_id::AstIdNode">AstId<wbr>Node</a></dt></dl><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="fn" href="fn.asm_expr_ast_id.html" title="fn span::ast_id::asm_expr_ast_id">asm_<wbr>expr_<wbr>ast_<wbr>id</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dt><a class="fn" href="fn.assoc_item_ast_id.html" title="fn span::ast_id::assoc_item_ast_id">assoc_<wbr>item_<wbr>ast_<wbr>id</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dt><a class="fn" href="fn.block_expr_ast_id.html" title="fn span::ast_id::block_expr_ast_id">block_<wbr>expr_<wbr>ast_<wbr>id</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dt><a class="fn" href="fn.extern_block_ast_id.html" title="fn span::ast_id::extern_block_ast_id">extern_<wbr>block_<wbr>ast_<wbr>id</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dt><a class="fn" href="fn.has_name_ast_id.html" title="fn span::ast_id::has_name_ast_id">has_<wbr>name_<wbr>ast_<wbr>id</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dt><a class="fn" href="fn.hash_ast_id.html" title="fn span::ast_id::hash_ast_id">hash_<wbr>ast_<wbr>id</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dt><a class="fn" href="fn.hash_ptr.html" title="fn span::ast_id::hash_ptr">hash_<wbr>ptr</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dt><a class="fn" href="fn.impl_ast_id.html" title="fn span::ast_id::impl_ast_id">impl_<wbr>ast_<wbr>id</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dt><a class="fn" href="fn.pack_hash_index_and_kind.html" title="fn span::ast_id::pack_hash_index_and_kind">pack_<wbr>hash_<wbr>index_<wbr>and_<wbr>kind</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dt><a class="fn" href="fn.should_alloc_assoc_item.html" title="fn span::ast_id::should_alloc_assoc_item">should_<wbr>alloc_<wbr>assoc_<wbr>item</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dt><a class="fn" href="fn.should_alloc_has_name.html" title="fn span::ast_id::should_alloc_has_name">should_<wbr>alloc_<wbr>has_<wbr>name</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dt><a class="fn" href="fn.u16_hash.html" title="fn span::ast_id::u16_hash">u16_<wbr>hash</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dt><a class="fn" href="fn.use_ast_id.html" title="fn span::ast_id::use_ast_id">use_<wbr>ast_<wbr>id</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt></dl><h2 id="types" class="section-header">Type Aliases<a href="#types" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="type" href="type.ArenaId.html" title="type span::ast_id::ArenaId">ArenaId</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt></dl></section></div></main></body></html>